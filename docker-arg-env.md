В Dockerfile можно использовать две основные инструкции для настройки переменных: `ARG` и `ENV`. Они служат разным целям, но могут взаимодействовать друг с другом. Давайте разберем, как они работают и чем отличаются.

---

## **`ARG` (Build Arguments)**

`ARG` используется для передачи переменных во время **сборки образа** (build time). Эти переменные доступны только на этапе сборки и не сохраняются в итоговом образе.

### Особенности `ARG`:
1. **Область видимости**: Доступны только во время сборки.
2. **Значение по умолчанию**: Можно задать значение по умолчанию в Dockerfile.
3. **Переопределение**: Значения можно переопределить с помощью флага `--build-arg` при запуске `docker build`.

### Пример использования `ARG`:

```Dockerfile
# Определяем аргумент с значением по умолчанию
ARG APP_VERSION=1.0.0

# Используем аргумент в инструкциях
FROM ubuntu:20.04
RUN echo "Building version ${APP_VERSION}"
```

Сборка с переопределением аргумента:

```bash
docker build --build-arg APP_VERSION=2.0.0 -t my-app .
```

---

## **`ENV` (Environment Variables)**

`ENV` используется для определения переменных окружения, которые будут доступны как во время сборки, так и во время выполнения контейнера (runtime).

### Особенности `ENV`:
1. **Область видимости**: Доступны как на этапе сборки, так и в запущенном контейнере.
2. **Сохранение в образе**: Переменные, заданные через `ENV`, сохраняются в итоговом образе и могут быть использованы в запущенном контейнере.
3. **Использование в командах**: Переменные `ENV` можно использовать в инструкциях `RUN`, `CMD`, `ENTRYPOINT` и других.

### Пример использования `ENV`:

```Dockerfile
# Определяем переменную окружения
ENV APP_ENV=production

# Используем переменную в инструкциях
RUN echo "Environment is ${APP_ENV}"
```

После сборки образа переменная `APP_ENV` будет доступна в контейнере:

```bash
docker run my-app echo $APP_ENV
# Вывод: production
```

---

## **Взаимодействие `ARG` и `ENV`**

`ARG` и `ENV` могут взаимодействовать друг с другом. Например, можно использовать `ARG` для передачи значений в `ENV`:

```Dockerfile
# Определяем ARG
ARG APP_VERSION=1.0.0

# Используем ARG для инициализации ENV
ENV APP_VERSION=${APP_VERSION}
```

В этом случае:
- Значение `APP_VERSION` передается через `--build-arg` во время сборки.
- Оно копируется в переменную окружения `ENV`, которая сохраняется в образе и доступна в контейнере.

Пример сборки:

```bash
docker build --build-arg APP_VERSION=2.0.0 -t my-app .
```

После запуска контейнера:

```bash
docker run my-app echo $APP_VERSION
# Вывод: 2.0.0
```

---

## **Различия между `ARG` и `ENV`**

| Характеристика          | `ARG` (Build Arguments)                     | `ENV` (Environment Variables)               |
|-------------------------|---------------------------------------------|---------------------------------------------|
| **Область видимости**   | Только во время сборки (build time)         | Во время сборки и выполнения (runtime)      |
| **Сохранение в образе** | Нет                                        | Да                                         |
| **Использование**       | Для настройки сборки                        | Для настройки окружения в контейнере        |
| **Переопределение**     | Через `--build-arg` при сборке              | Через `-e` при запуске контейнера           |

---

## **Пример совместного использования `ARG` и `ENV`**

```Dockerfile
# Определяем ARG
ARG APP_VERSION=1.0.0

# Используем ARG для инициализации ENV
ENV APP_VERSION=${APP_VERSION}

# Дополнительные инструкции
RUN echo "Building version ${APP_VERSION}"
```

Сборка:

```bash
docker build --build-arg APP_VERSION=2.0.0 -t my-app .
```

Запуск контейнера:

```bash
docker run my-app echo $APP_VERSION
# Вывод: 2.0.0
```

---

## **Когда использовать `ARG` и `ENV`?**
- Используйте `ARG`, если вам нужно передать параметры только на этапе сборки (например, версию приложения, путь к файлу и т.д.).
- Используйте `ENV`, если вам нужно настроить переменные окружения, которые будут доступны в запущенном контейнере (например, настройки среды выполнения, ключи API и т.д.).

---

## **Заключение**
`ARG` и `ENV` — это мощные инструменты для настройки Docker-образов. `ARG` позволяет гибко управлять параметрами сборки, а `ENV` — настраивать окружение для запуска контейнера. Их совместное использование делает Dockerfile более универсальным и адаптируемым под разные сценарии.


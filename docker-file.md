В Dockerfile инструкции `CMD` и `ENTRYPOINT` используются для определения команды, которая будет выполняться при запуске контейнера. Они играют важную роль в том, как контейнер инициализируется и работает. Однако между ними есть ключевые различия, которые важно понимать.

---

### 1. **`CMD`**
Инструкция `CMD` определяет команду по умолчанию, которая будет выполняться при запуске контейнера. Если при запуске контейнера пользователь передает свои аргументы, они переопределяют `CMD`.

#### Особенности:
- Используется для предоставления команды по умолчанию.
- Может быть переопределена при запуске контейнера.
- Если в Dockerfile указано несколько `CMD`, выполняется только последняя.

#### Форматы записи:
1. **Exec-формат** (рекомендуется):
   ```dockerfile
   CMD ["executable", "param1", "param2"]
   ```
   Пример:
   ```dockerfile
   CMD ["nginx", "-g", "daemon off;"]
   ```

2. **Shell-формат**:
   ```dockerfile
   CMD command param1 param2
   ```
   Пример:
   ```dockerfile
   CMD nginx -g "daemon off;"
   ```

#### Пример Dockerfile с `CMD`:
```dockerfile
FROM ubuntu:latest
CMD ["echo", "Hello, World!"]
```
При запуске контейнера:
```bash
docker run <image>
```
Вывод:
```
Hello, World!
```

Если передать аргументы при запуске:
```bash
docker run <image> echo "Override CMD"
```
Вывод:
```
Override CMD
```

---

### 2. **`ENTRYPOINT`**
Инструкция `ENTRYPOINT` определяет основную команду, которая будет выполняться при запуске контейнера. Аргументы, переданные при запуске контейнера, добавляются к команде `ENTRYPOINT`, а не переопределяют её.

#### Особенности:
- Используется для определения основной команды контейнера.
- Аргументы, переданные при запуске, добавляются к `ENTRYPOINT`.
- Если в Dockerfile указано несколько `ENTRYPOINT`, выполняется только последняя.

#### Форматы записи:
1. **Exec-формат** (рекомендуется):
   ```dockerfile
   ENTRYPOINT ["executable", "param1", "param2"]
   ```
   Пример:
   ```dockerfile
   ENTRYPOINT ["nginx", "-g", "daemon off;"]
   ```

2. **Shell-формат**:
   ```dockerfile
   ENTRYPOINT command param1 param2
   ```
   Пример:
   ```dockerfile
   ENTRYPOINT nginx -g "daemon off;"
   ```

#### Пример Dockerfile с `ENTRYPOINT`:
```dockerfile
FROM ubuntu:latest
ENTRYPOINT ["echo", "Hello"]
```
При запуске контейнера:
```bash
docker run <image> World
```
Вывод:
```
Hello World
```

---

### 3. **Комбинация `ENTRYPOINT` и `CMD`**
`ENTRYPOINT` и `CMD` могут использоваться вместе. В этом случае `CMD` предоставляет аргументы по умолчанию для `ENTRYPOINT`. Если при запуске контейнера передаются аргументы, они заменяют `CMD`.

#### Пример Dockerfile:
```dockerfile
FROM ubuntu:latest
ENTRYPOINT ["echo", "Hello"]
CMD ["World"]
```
При запуске контейнера:
```bash
docker run <image>
```
Вывод:
```
Hello World
```

Если передать аргументы:
```bash
docker run <image> Docker
```
Вывод:
```
Hello Docker
```

---

### 4. **Различия между `CMD` и `ENTRYPOINT`**

| Характеристика          | `CMD`                              | `ENTRYPOINT`                      |
|-------------------------|------------------------------------|------------------------------------|
| **Назначение**          | Команда по умолчанию               | Основная команда контейнера       |
| **Переопределение**     | Полностью переопределяется         | Аргументы добавляются к команде   |
| **Использование**       | Для предоставления аргументов      | Для определения основной логики   |
| **Пример**              | `CMD ["nginx", "-g", "daemon off;"]` | `ENTRYPOINT ["nginx", "-g", "daemon off;"]` |

---

### 5. **Рекомендации по использованию**
- Используйте `ENTRYPOINT`, если хотите, чтобы контейнер всегда выполнял определенную команду, а аргументы добавлялись к ней.
- Используйте `CMD`, если хотите предоставить команду по умолчанию, которую можно легко переопределить.
- Комбинируйте `ENTRYPOINT` и `CMD`, если хотите задать основную команду и аргументы по умолчанию.

---

### Пример использования в реальной жизни

#### Dockerfile для веб-сервера:
```dockerfile
FROM nginx:latest
ENTRYPOINT ["nginx"]
CMD ["-g", "daemon off;"]
```
- `ENTRYPOINT` указывает, что контейнер всегда будет запускать `nginx`.
- `CMD` предоставляет аргументы по умолчанию.

При запуске:
```bash
docker run <image>
```
Контейнер запустит:
```
nginx -g "daemon off;"
```

Если передать аргументы:
```bash
docker run <image> -t
```
Контейнер запустит:
```
nginx -t
```

---

### Заключение
- `CMD` и `ENTRYPOINT` — это мощные инструменты для управления поведением контейнера.
- Понимание их различий и правильное использование позволяет создавать гибкие и удобные Docker-образы.